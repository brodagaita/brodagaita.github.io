<!--
=========================================================
 Paper Kit 2 - v2.2.0
=========================================================

 Product Page: https://www.creative-tim.com/product/paper-kit-2
 Copyright 2019 Creative Tim (https://www.creative-tim.com)
 Licensed under MIT (https://github.com/creativetimofficial/paper-kit-2/blob/master/LICENSE.md)

 Coded by Creative Tim

=========================================================

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. -->

<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="./assets/img//apple-icon.png">
  <link rel="icon" type="image/png" href="./assets/img//favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Local Currency
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
    name='viewport' />
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="./assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="./assets/css/paper-kit.css?v=2.2.0" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="./assets/demo/demo.css" rel="stylesheet" />
  <style>
    .black-bg {
      color: white;
    }

    .description {
      color: rgb(26, 26, 26) !important;
    }

    @media (max-width:959px) and (min-width:400px) {
      .logos {
        display: block;
        margin: 0% !important;
        max-width: 98%;
        margin-left: 12% !important;
      }

      #dvision {
        margin-left: 15% !important;
      }

      #bottom {
        margin-top: -15%;
      }

      .card-size {
        width: 90% !important;
        margin-left: 5%;
      }
    }

    @media (max-width:399px) {
      .logos {
        display: block;
        margin: 0% !important;
        max-width: 98%;
      }

      #dvision {
        margin-left: 15%;
      }

      #bottom {
        margin-top: -15%;
      }

      .card-size {
        width: 90% !important;
        margin-left: 5%;
      }
    }

    #spinning-circle {
      animation-name: spinning-circle;
      animation-duration: 4s;
      animation-iteration-count: infinite;
      width: 40px;
      height: 40px;
    }

    @-webkit-keyframes spinning-circle {
      0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
      }

      100% {
        -webkit-transform: rotate(360deg);
        transform: rotate(360deg);
      }
    }

    #spinning-circle img {
      width: 100%;
      height: auto;
    }

    .card {
      margin-left: 2% !important;
      margin-right: 2% !important;
      line-height: 1;
    }

    .btn-tiny {
      padding-left: 1%;
      padding-right: 1%;
      padding-top: 0%;
      padding-bottom: 0%;
    }
  </style>

</head>

<body class="landing-page sidebar-collapse">
  <!-- End Navbar -->
  <div class="page-header" data-parallax="true" style="background-image: url('./assets/img/factory.png');">
    <div class="filter"></div>
    <div class="container">
      <div class="motto text-center">
        <h1>Token Factory</h1>
        <center>
          <h3 id="headline" style="width: 80%; text-align: center"> Create your own local currency from scratch,
            following our proposed implementation.
            No code required. (Under Development)</h3>
          <br>
          <p id="contract"></p>
        </center>
        <br />
      </div>
    </div>
  </div>
  <div class="main">
    <div class="section text-center">
      <div class="container" id="dashboard">
        <div class="row">
          <div class="col-md-8 ml-auto mr-auto">
          </div>
          <div class="col-lg-12 ml-auto mr-auto">
            <h2 class="title"> Select one </h2>
            <h4> Factory is currently live on Ropsten test network only. </h2>
              <br>
              <button class="btn btn-danger" style="margin-right: 2%;" onclick="loadCreate()">Create new token</button>
              <button class="btn btn-danger" onclick="loadManage()">Manage your tokens</button>
              <br>
          </div>
        </div>

      </div>
    </div>

    <div id="selectionSpace">

    </div>
  </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Creating your token</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="modBod">
          <center>
            <div id="spinning-circle">
              <img src="https://i.stack.imgur.com/WbNlQ.jpg">
            </div>
          </center>
        </div>
        <div class="modal-footer" id='modFoot'>

        </div>


      </div>
    </div>
  </div>

  <!-- Foundation Options Modal -->
  <div class="modal fade" id="foundationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="exampleModalLabel">Manage Foundation</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
          <center>
            <!-- <h5>You are currently the Chairperson.</h5>
            <p>Chairperson: 0xdfd75ca106455338d368bfd84e2c4355bd7d2654</p>
            <p>Next in Line: 0xdfd75ca106455338d368bfd84e2c4355bd7d2654</p> -->
          </center>

          <br>
          <br>
          <div class="button-set" style="width: 100%">
            <button style="max-width: 20%; float: right;" class="btn btn-sm btn-tiny btn-info"
              onclick="voteToAdd()">Vote</button>
            <label style="max-width: 40%; float: left; margin-left: 10%;">Vote to add:</label>
            <input style="max-width: 40%; float: right; margin-right: 2%;" type="text" id="addVal">
            <br>
          </div>
          <br>
          <div class="button-set" style="width: 100%">
            <button style="max-width: 20%; float: right;" class="btn btn-sm btn-tiny btn-info"
              onclick="voteToRemove()">Vote</button>
            <label style="max-width: 40%; float: left; margin-left: 10%;">Vote to remove:</label>
            <input style="max-width: 40%; float: right; margin-right: 2%;" type="text" id="removeVal">
            <br>
          </div>
          <br>
          <div class="button-set" style="width: 100%">
            <button style="max-width: 20%; float: right; margin-right: 1%;" class="btn btn-sm btn-tiny btn-info"
              onclick="addToWhitelist()">Add</button>
            <label style="max-width: 40%; float: left; margin-left: 10%;">Add to Whitelist:</label>
            <input style="max-width: 40%; float: right; margin-right: 2%;" type="text" id="whitelistVal">
            <br>
          </div>
          <br>
          <div class="button-set" style="width: 100%">
            <button style="max-width: 20%; float: right; margin-right: 1%;" class="btn btn-sm btn-tiny btn-info"
              onclick="addToBlacklist()">Add</button>
            <label style="max-width: 40%; float: left; margin-left: 10%;">Add to Blacklist:</label>
            <input style="max-width: 40%; float: right; margin-right: 2%;" type="text" id="blacklistVal">
            <br>
          </div>
        </div>
        <br>
        <div style="width: 100%">
          <center>
            <p id="whitelistStatus"></p>
          </center>
          <br>
        </div>
      </div>
      </div>
    </div>
  </div>

  </div>
  </div>

  <!-- Burn Modal -->
  <div class="modal fade" id="burnModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Burn tokens</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <center>
            <label>Number of tokens to burn: </label>
            <input type="number" id="burnVal">
            <br>
            <small>Only tokens from the Chairperson's account can be burned.</small>
            <br>
            <br>
            <button class="btn btn-info btn-md" onclick="burn()">Update</button>
          </center>
        </div>

      </div>
    </div>
  </div>


  <!-- Transfer Modal -->
  <div class="modal fade" id="txModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Send tokens to another address</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Remember that only whitelisted addresses can receive tokens by default. You can disable the whitelist in "Foundation Options".</p>
          <br>
          <center>
            <label>Number of tokens to send: </label>
            <input type="text" id="tokenVal">
            <br>
            <label>Receiving address: </label>
            <input type="text" id="receiverVal">
            <br>
            <br>
            <button class="btn btn-info btn-md" onclick="send()">Send</button>
          </center>
        </div>

      </div>
    </div>
  </div>

  <!-- Update Supply Modal -->
  <div class="modal fade" id="supplyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Increase supply of tokens</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <center>
            <label>New Total Supply: </label>
            <input type="number" id="supplyVal">
            <br>
            <br>
            <button class="btn btn-info btn-md" onclick="updateSupply()">Update</button>
          </center>
        </div>

      </div>
    </div>
  </div>


  <!-- Change Cap Modal -->
  <div class="modal fade" id="capModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Update the cap on tokens per address</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <center>
            <label>New Cap: </label>
            <input type="number" id="capVal">
            <br>
            <br>
            <button class="btn btn-info btn-md" onclick="updateCap()">Update</button>
          </center>
        </div>

      </div>
    </div>
  </div>


  <!-- Loading Modal -->
  <div class="modal fade" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Processing transaction</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <center>
            <div id="spinning-circle">
              <img src="http://i.stack.imgur.com/WbNlQ.jpg">
            </div>
          </center>
        </div>

      </div>
    </div>
  </div>



  <!--   Core JS Files   -->
  <script src="./assets/js/core/jquery.min.js" type="text/javascript"></script>
  <script src="./assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="./assets/js/core/bootstrap.min.js" type="text/javascript"></script>
  <script src="./assets/js/core/bootstrap.min.js" type="text/javascript"></script>

  <script>


    var beginning = '<div class="form-group"> <label for="exampleInputEmail1">';
    var middle = ' (ETH Address)</label><input type="text" class="form-control" id="'
    var end = '" aria-describedby="emailHelp" placeholder="0x">   </div>'

    var tokenDashboard = ' <center> <div class="alert alert-info alert-wrapper" style="max-width: 50%; padding-bottom: 2%;"> <h3>Your balance: <span id="userBalance"></span></h3> <br> <button class="btn btn-info btn-sm" style="margin-right: 2%;" onclick="openTxModal()">Send Tokens</button> <br> </div> <br> </center> <h3><b>Manage Token Properties</b></h3> <br> <br> <div class="row"> <div class="col-lg-12 ml-auto mr-auto card-row" style="max-width: 100%;"> <center> <div style="float:left; width:20%; visibility: hidden;"> . </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h4 class="card-title">Name</h4> <br> <h3 id="tokenName"></h3> <p style="visibility: hidden;"> . </p> </div> </div> </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h4 class="card-title">Symbol</h4> <br> <h3 id="tokenSymbol"></h3> <p style="visibility: hidden;"> . </p> </div> </div> </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h4 class="card-title">Total Supply</h4> <h3 id="tokenSupply"></h3> <br> <p> <center> <button href="#" style="border: 0px; background-color: transparent; color: black" class="card-link" onclick="openBurn()">Decrease</button> <button href="#" style="border: 0px; background-color: transparent; color: black" class="card-link" onclick="openIncreaseSupply()">Increase</button> </center> </p> </div> </div> </div> <div style="float:left; width:20%; visibility: hidden;"> . </div> </center> </div> </div> <div class="row"> <div class="col-lg-12 ml-auto mr-auto card-row" style="max-width: 100%;"> <center> <div style="float:left; width:20%; visibility: hidden;"> . </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h4 class="card-title">Decimals</h4> <br> <h3 id="tokenDecimals"></h3> <p style="visibility: hidden;"> . </p> </div> </div> </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h4 class="card-title">Cap</h4> <h3 id="tokenCap"></h3> <br> <br> <center> <button href="#" style="border: 0px; background-color: transparent; color: black" class="card-link" onclick="openUpdateCap()">Change</button> </center> </div> </div> </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h4 class="card-title">Chairperson</h4> <br> <br> <small id="tokenChairperson"></small> <center> <p style="visibility: hidden;"> . </p> </center> </div> </div> </div> <div style="float:left; width:20%; visibility: hidden;"> . </div> </center> </div> </div> <div class="row"> <div class="col-lg-12 ml-auto mr-auto card-row" style="max-width: 100%;"> <center> <div style="float:left; width:20%; visibility: hidden;"> . </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h5 class="card-title">Upper boundary: Tx number</h5> <br> <h3 id="tokenTransactions"></h3> <p style="visibility: hidden;"> . </p> </div> </div> </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h5 class="card-title">Upper boundary: Distinct addresses</h5> <br> <h3 id="tokenAddresses"></h3> <p style="visibility: hidden;"> . </p> </div> </div> </div> <div style="float:left; width:20%;" class="card-size"> <div class="card"> <div class="card-body"> <h5 class="card-title">Upper boundary: Time</h5> <br> <h3 id="tokenTime"></h3> <p style="visibility: hidden;"> . </p> </div> </div> </div> <div style="float:left; width:20%; visibility: hidden;"> . </div> </center> </div> </div> <button class="btn btn-sm" style="border: 0px; background-color: transparent; color: black; font-size: 100%;" onclick="openFoundationOptions()">Open Foundation Options</button>';
    var contractAddress;

    var TokenContract = web3.eth.contract([
	{
		"constant": true,
		"inputs": [],
		"name": "whitelistActive",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "name",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "spender",
				"type": "address"
			},
			{
				"name": "tokens",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "nextInLine",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "totalSupply",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "newChairperson",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "maxTime",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "from",
				"type": "address"
			},
			{
				"name": "to",
				"type": "address"
			},
			{
				"name": "tokens",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "maxTransactions",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "chairperson",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "decimals",
		"outputs": [
			{
				"name": "",
				"type": "uint8"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "cap",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "acceptChairpersonship",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_ad",
				"type": "address"
			}
		],
		"name": "isWhitelisted",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "toAdd",
				"type": "address"
			}
		],
		"name": "addToBlackList",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "numberOfTokens",
				"type": "uint256"
			}
		],
		"name": "burn",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_ad",
				"type": "address"
			}
		],
		"name": "isAddressInFoundation",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_ad",
				"type": "address"
			}
		],
		"name": "voteToAdd",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "newSupply",
				"type": "uint256"
			}
		],
		"name": "updateSupply",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_newChairperson",
				"type": "address"
			}
		],
		"name": "transferChairpersonship",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "tokenOwner",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"name": "balance",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_ad",
				"type": "address"
			}
		],
		"name": "voteToRemove",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "changeWhitelistStatus",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_ad",
				"type": "address"
			}
		],
		"name": "selectNextInLine",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "ad",
				"type": "address"
			}
		],
		"name": "getConversionFee",
		"outputs": [
			{
				"name": "",
				"type": "uint8"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "toRemove",
				"type": "address"
			}
		],
		"name": "removeFromWhitelist",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "maxAddresses",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "symbol",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "votesToRemove",
		"outputs": [
			{
				"name": "",
				"type": "uint8"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "numberOfVoters",
		"outputs": [
			{
				"name": "",
				"type": "uint8"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_newCap",
				"type": "uint256"
			}
		],
		"name": "updateCap",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "to",
				"type": "address"
			},
			{
				"name": "tokens",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "addressesVotedOn",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "spender",
				"type": "address"
			},
			{
				"name": "tokens",
				"type": "uint256"
			},
			{
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "approveAndCall",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "isFoundation",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "tokenAddress",
				"type": "address"
			},
			{
				"name": "tokens",
				"type": "uint256"
			}
		],
		"name": "transferAnyERC20Token",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "tokenOwner",
				"type": "address"
			},
			{
				"name": "spender",
				"type": "address"
			}
		],
		"name": "allowance",
		"outputs": [
			{
				"name": "remaining",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "votesToAdd",
		"outputs": [
			{
				"name": "",
				"type": "uint8"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "toAdd",
				"type": "address"
			}
		],
		"name": "addToWhitelist",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_ad",
				"type": "address"
			},
			{
				"name": "_choice",
				"type": "uint8"
			}
		],
		"name": "removeMyVote",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"name": "_name",
				"type": "string"
			},
			{
				"name": "_symbol",
				"type": "string"
			},
			{
				"name": "_decimals",
				"type": "uint8"
			},
			{
				"name": "_foundation",
				"type": "address[4]"
			},
			{
				"name": "_cap",
				"type": "uint256"
			},
			{
				"name": "_supply",
				"type": "uint256"
			},
			{
				"name": "_maxTxs",
				"type": "uint256"
			},
			{
				"name": "_maxTime",
				"type": "uint256"
			},
			{
				"name": "_maxAddresses",
				"type": "uint256"
			},
			{
				"name": "_safety",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"payable": true,
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"name": "_from",
				"type": "address"
			},
			{
				"indexed": true,
				"name": "_to",
				"type": "address"
			}
		],
		"name": "LogChairpersonshipTransfer",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "tokens",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"name": "tokenOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"name": "spender",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "tokens",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	}
]
    );
    var Token;


    var getEvents = true;

    function loadFields() {
      console.log('here')
      var n = document.getElementById("nMembers").value;
      document.getElementById('foundation').innerHTML = '';
      for (var i = 0; i < document.getElementById("nMembers").value; i++) {
        if (i == 0) {
          document.getElementById('foundation').innerHTML += beginning + "Chairperson" + middle + String('fnd' + (i + 1)) + end;
        }
        else if (i == 1) {
          document.getElementById('foundation').innerHTML += beginning + "Next in Line " + middle + String('fnd' + (i + 1)) + end;
        }
        else {
          document.getElementById('foundation').innerHTML += beginning + "Foundation Member " + (i + 1) + middle + String('fnd' + (i + 1)) + end;
        }
      }
    }

    var create = ' <div class="row"> <div class="col-md-4 ml-auto mr-auto"> <h5> Make sure you have MetaMask downloaded and unlocked </h5> <p> <b>Your address: </b><span id="address">No address detected - Please refresh page</span> </p> <br> <br> <form> <div class="form-group"> <label for="exampleInputEmail1">Token Name</label> <input type="text" class="form-control" id="name" aria-describedby="emailHelp" placeholder=""> </div> <div class="form-group"> <label for="exampleInputPassword1">Token Symbol</label> <input type="text" class="form-control" id="symbol" placeholder="Example: SYMB"> <small id="emailHelp" class="form-text text-muted"> It is suggested to keep the symbol between 3-4 characters. </small> </div> <div class="form-group"> <label for="exampleInputEmail1">Decimals</label> <input type="number" class="form-control" id="decimals" placeholder="0" max="18"> <small id="emailHelp" class="form-text text-muted">Up to how many decimals a unit of your token will be divisible to. Example: traditional currencies are divisible up to two decimals (The lowest denomination of a dollar is 1/100 of a dollar, called a cent). <b>Suggested Value: 0</b>. </small> </div> <div class="form-group"> <label for="exampleInputEmail1">Cap on ownership</label> <input type="text" class="form-control" id="cap" aria-describedby="emailHelp" placeholder="Example: 5000"> <small id="emailHelp" class="form-text text-muted">Maximum amount of tokens a standard user can have at a given time. Leave this blank if you do not wish to have a cap.</small> </div> <div class="form-group"> <label for="exampleInputEmail1">Initial/Total Supply</label> <input type="number" class="form-control" id="supply" aria-describedby="emailHelp" placeholder=""> <small id="emailHelp" class="form-text text-muted">Number of tokens available from creation (Should correspond to the amount of collateral in a real-world system). This number can be changed later.</small> </div> <br> <h5> The following fields refer to the Tiers of Conversion model. If you are not familiar with the model, please refer to Section 4.5 of this paper. You can also leave the fields blank to use our default values. </h5> <br> <div class="form-group"> <label for="exampleInputEmail1">Upper boundary for number of transactions</label> <input type="number" class="form-control" id="maxTxs" aria-describedby="emailHelp" placeholder=""> </div> <div class="form-group"> <label for="exampleInputEmail1">Upper boundary for time since joining the platform</label> <input type="number" class="form-control" id="maxTime" aria-describedby="emailHelp" placeholder=""> <small id="emailHelp" class="form-text text-muted">Values are in months</small> </div> <div class="form-group"> <label for="exampleInputEmail1">Upper boundary for number of distinct addresses transacted with</label> <input type="number" class="form-control" id="maxAddresses" aria-describedby="emailHelp" placeholder=""> </div> <br> <h5> Establishing the Foundation </h5> <br> <div class="form-group"> <label for="exampleFormControlSelect2">Number of founding members in Foundation</label> <select multiple class="form-control" id="nMembers" onchange="loadFields()"> <option>1</option> <option>2</option> <option>3</option> <option>4</option> </select> <small id="emailHelp" class="form-text text-muted">More can be added later</small> </div> <div id="foundation"> </div> <div class="form-check"> <label class="form-check-label"> <input class="form-check-input" type="checkbox" id="safety" value=""> Is the Chairperson the creator of the contract? <span class="form-check-sign"> <span class="check"></span> </span> </label> </div> <br><center> <button onclick="setParameters()" class="btn btn-primary" type="button">Create Token</button> </center> </form> </div></div>'

    function loadCreate() {
      document.getElementById('selectionSpace').innerHTML = create;
      setTimeout(function () {
        if (web3.eth.accounts[0] != "") {
          document.getElementById('address').innerHTML = web3.eth.accounts[0];
        }
      }, 500)
    }



    // web3 = new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/v3/d81a3501521247ce9a510f4e8317219b"));
    // web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:7545"));

    window.addEventListener('load', async () => {
      if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        try {
          await ethereum.enable();
          web3.eth.sendTransaction({});
        } catch (error) {
          //web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:7545"));
          // web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/d81a3501521247ce9a510f4e8317219b"));
          // window.web3 = new Web3(ethereum);
          web3 = new Web3(web3.currentProvider);
        }
      }
      else if (window.web3) {
        window.web3 = new Web3(web3.currentProvider);
        web3.eth.sendTransaction({/*...*/ });
      }
      else {
        // web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:7545"));
        web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/d81a3501521247ce9a510f4e8317219b"));
        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
      }
    });

    var FactoryContract = web3.eth.contract([
      {
        "constant": false,
        "inputs": [
          {
            "name": "_name",
            "type": "string"
          },
          {
            "name": "_symbol",
            "type": "string"
          },
          {
            "name": "_decimals",
            "type": "uint8"
          },
          {
            "name": "_foundation",
            "type": "address[4]"
          },
          {
            "name": "_cap",
            "type": "uint256"
          },
          {
            "name": "_supply",
            "type": "uint256"
          },
          {
            "name": "_maxTxs",
            "type": "uint256"
          },
          {
            "name": "_maxTime",
            "type": "uint256"
          },
          {
            "name": "_maxAddresses",
            "type": "uint256"
          },
          {
            "name": "_safety",
            "type": "bool"
          }
        ],
        "name": "createNewToken",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": false,
            "name": "_creator",
            "type": "address"
          },
          {
            "indexed": false,
            "name": "_token",
            "type": "address"
          }
        ],
        "name": "NewTokenCreated",
        "type": "event"
      },
      {
        "constant": true,
        "inputs": [
          {
            "name": "_contract",
            "type": "address"
          }
        ],
        "name": "getContractName",
        "outputs": [
          {
            "name": "",
            "type": "string"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      },
      {
        "constant": true,
        "inputs": [
          {
            "name": "_user",
            "type": "address"
          }
        ],
        "name": "getUserTokens",
        "outputs": [
          {
            "name": "",
            "type": "address[]"
          }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
      }
    ]
    );
    var factoryAddress = "0xa0ee8a9b55043440a79c825dba09be69c3f9b092";
    var Factory = FactoryContract.at(factoryAddress);


    var nm, sym, dec, cp, sup, txs, tme, adr, saf;
    var fnd = [];

    function setParameters() {
      nm = document.getElementById('name').value;
      sym = document.getElementById('symbol').value;
      dec = document.getElementById('decimals').value;
      cp = document.getElementById('cap').value;
      sup = document.getElementById('supply').value;
      txs = document.getElementById('maxTxs').value;
      tme = document.getElementById('maxTime').value;
      adr = document.getElementById('maxAddresses').value;
      saf = !(document.getElementById('safety').checked);
      for (var i = 0; i < 4; i++) {
        if (document.getElementById(String('fnd' + (i + 1))) == null) {
          fnd.push('0x0000000000000000000000000000000000000000');
        }
        else {
          fnd.push(document.getElementById(String('fnd' + (i + 1))).value);
        }
      }
      createToken(nm, sym, dec, cp, sup, txs, tme, adr);
    }



    function createToken(name, symbol, decimals, cap, supply, maxTxs, maxTime, maxAddresses) {
      var found = fnd;
      // console.log(fnd, name, symbol, decimals, cap, supply, maxTxs, maxTime, maxAddresses, safety);
      var tx = Factory.createNewToken(name, symbol, decimals, found, cap, supply, maxTxs, maxTime, maxAddresses, false, {
        from: web3.eth.accounts[0],
        // gas: "3000000",
        to: factoryAddress,
        // value: checkPrice(0),
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#exampleModal').modal('toggle');
          console.log(transactionHash);
          fnd.length = 0;
        }
        else {
          console.log(err);
        }
      }
      )
    };


    Factory.allEvents({
      fromBlock: web3.eth.defaultBlock
    }, (error, event) => {
      if (event.args._creator == web3.eth.accounts[0]) {
        console.log(event.args);
        document.getElementById('modBod').innerHTML = "<p> Success! Contract " + '<span id="newAdr">' + event.args._token + "</span> created. </p>";
        document.getElementById('modFoot').innerHTML = ' <div class="left-side"> <button type="button" class="btn btn-default btn-link" data-dismiss="modal">Close</button> </div> <div class="divider"></div> <div class="right-side"> <button type="button" onclick="preLoad()" class="btn btn-danger btn-link">Use token</button> </div>';
      } else { }
    });

    /*
    setTimeout(function() {
      createToken("test", "TST", 0, ["0x5c7AD20DC173dFa74C18E892634E1CA27E8E472F", "0x5c7AD20DC173dFa74C18E892634E1CA27E8E472F", "0x5c7AD20DC173dFa74C18E892634E1CA27E8E472F", "0x5c7AD20DC173dFa74C18E892634E1CA27E8E472F"], 1000, 10000, 100, 21, 100, false);
    },1000)
    */

    var userTokens;
    var contractNames = [];


    function loadManage() {
      document.getElementById('selectionSpace').innerHTML = '<div class="row" id="selector" style="margin-bottom: -4%;"><div class="col-md-4 ml-auto mr-auto"><div class="form-group"> <label for="exampleFormControlSelect2">Select a contract to interact with:</label><select multiple class="form-control" id="myTokens" onchange=""> </select><br><br></div></div></div><br><center><div class="row"><div class="col-md-4 ml-auto mr-auto"><p>Or input the address of a Contract not on the list: &nbsp; &nbsp;</p><input type="text" id="contractInput" style="width: 70%"><br><small style="max-width: 70%;">Contract must follow the SocialToken pattern.</small></div></div></center><center><br> <button class="btn btn-info btn-sm" onclick="loadSelectedContract(false)"> Load </button> </center>';
      getUserTokens();
    }


    function getUserTokens() {
      Factory.getUserTokens(web3.eth.accounts[0], (err, arr) => {
        if (!err) {
          userTokens = arr;
          getContractNames(arr, 0, arr.length);
        }
      });
    }

    function getContractNames(arr, i, l) {
      if (i != l) {
        Factory.getContractName(arr[i], (err, name) => {
          contractNames.push(name);
          getContractNames(arr, i + 1, l);
        });
      }
      else {
        console.log("tokens: " + userTokens);
        console.log("names: " + contractNames);
        setSelector(l);
      }
    }

    function setSelector(length) {
      for (var i = 0; i <= length; i++) {
        if (i != length) {
          var opt = document.createElement("option");
          opt.innerHTML = contractNames[i] + ' (' + userTokens[i] + ')';
          opt.value = userTokens[i];
          document.getElementById('myTokens').appendChild(opt);
        }
        else {
          contractNames = [];
          userTokens = [];
        }
      }
    }

    // PLANE -------------------


    function openFoundationOptions() {
      $('#foundationModal').modal('toggle');
      whitelistStatus();
    }

    function loadSelectedContract(adr) {
      document.getElementById('dashboard').innerHTML = tokenDashboard;
      setTimeout(function () {
        if (adr != false) {
          Token = TokenContract.at(adr);
          $('#exampleModal').modal('hide');
          buildTokenDashboard();
        }
        else if (document.getElementById('contractInput').value == "") {
          contractAddress = document.getElementById('myTokens').value;
          console.log('if', contractAddress);
          Token = TokenContract.at(contractAddress);
          buildTokenDashboard();
        }
        else {
          contractAddress = document.getElementById('contractInput').value;
          Token = TokenContract.at(contractAddress);
          buildTokenDashboard(Token);
        }
      }, 500);
      setTimeout(function () {
        document.getElementById('selectionSpace').innerHTML = "";
      }, 700)
    }



    function buildTokenDashboard() {
      console.log(Token);
      document.getElementById('dashboard').innerHTML += '<script>' + 'Token.allEvents({fromBlock: web3.eth.defaultBlock}, (error, event) => {$("#loadingModal").modal("hide"); alert("Update successful.")})' + '<\/script>';
      addCode('Token.allEvents({fromBlock: web3.eth.defaultBlock}, (error, event) => {$("#loadingModal").modal("hide"); alert("Update successful.")})');
      Token.balanceOf(web3.eth.accounts[0], (error, result) => {
        document.getElementById('userBalance').innerHTML = result;
      });
      Token.name((error, result) => {
        document.getElementById('tokenName').innerHTML = result;
      });
      Token.symbol((error, result) => {
        document.getElementById('tokenSymbol').innerHTML = result;
      });
      Token.totalSupply((error, result) => {
        document.getElementById('tokenSupply').innerHTML = result;
      });
      Token.decimals((error, result) => {
        document.getElementById('tokenDecimals').innerHTML = result;
      });
      Token.cap((error, result) => {
        document.getElementById('tokenCap').innerHTML = result;
      });
      Token.chairperson((error, result) => {
        document.getElementById('tokenChairperson').innerHTML = result;
      });
      Token.maxTransactions((error, result) => {
        document.getElementById('tokenTransactions').innerHTML = result;
      });
      Token.maxAddresses((error, result) => {
        document.getElementById('tokenAddresses').innerHTML = result;
      });
      Token.maxTime((error, result) => {
        document.getElementById('tokenTime').innerHTML = result;
      });
    }

    function openBurn() {
      $('#burnModal').modal('toggle');
    }

    function openTxModal() {
      $('#txModal').modal('toggle');
    }


    function openUpdateSupply() {
      $('#supplyModal').modal('toggle');
    }


    function openUpdateCap() {
      $('#capModal').modal('toggle');
    }

    function preLoad() {
      loadSelectedContract(document.getElementById('newAdr').innerHTML);
    }

    function burn() {
      var tx = Token.burn(document.getElementById('burnVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
        }
        else {
          console.log(err);
        }
      }
      )
    };

    function send() {
      var nTokens = document.getElementById('tokenVal').value;
      var receiverAddress = document.getElementById('receiverVal').value;
      var tx = Token.transfer(nTokens, receiverAddress, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
        }
        else {
          console.log(err);
        }
      }
      )
    };


    function updateCap() {
      var tx = Token.updateCap(document.getElementById('capVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
        }
        else {
          console.log(err);
        }
      }
      )
    }

    function updateSupply() {
      var tx = Token.updateSupply(document.getElementById('supplyVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
        }
        else {
          console.log(err);
        }
      }
      )
    }

    function voteToAdd() {
      var tx = Token.voteToAdd(document.getElementById('addVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
          $('#addModal').modal('hide');
        }
        else {
          console.log(err);
        }
      }
      )
    }

    function voteToRemove() {
      var tx = Token.updateSupply(document.getElementById('removeVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
          $('#removeModal').modal('hide');
        }
        else {
          console.log(err);
        }
      }
      )
    }

    function addToWhitelist() {
      var tx = Token.addToWhitelist(document.getElementById('whitelistVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
          $('#whitelistModal').modal('hide');
        }
        else {
          console.log(err);
        }
      }
      )
    }


    function addToBlackList() {
      var tx = Token.addToWhitelist(document.getElementById('blacklistVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
          $('#blacklistModal').modal('hide');
        }
        else {
          console.log(err);
        }
      }
      )
    }

    function changeWhitelistStatus() {
      var tx = Token.changeWhiteListStatus(document.getElementById('whitelistStatusVal').value, {
        from: web3.eth.accounts[0],
        to: factoryAddress,
        data: ""
      }, function (err, transactionHash) {
        if (!err) {
          $('#loadingModal').modal('toggle');
        }
        else {
          console.log(err);
        }
      }
      )
    }

    function whitelistStatus() {
      Token.whitelistActive((error, active) => {
         if (active) {
           document.getElementById('whitelistStatus').innerHTML = "Whitelist is enabled. Click <button style='background-color: transparent; border: none;' onclick='changeWhitelistStatus()'> here </button> to disable;";
         }
         else {
          document.getElementById('whitelistStatus').innerHTML = "Whitelist is disabled. Click <button style='background-color: transparent; border: none;' onclick='changeWhitelistStatus()'> here </button>  to enable.";
         }
      });
    }

    function addCode(code) {
      var JS = document.createElement('script');
      JS.text = code;
      document.body.appendChild(JS);
    }

    Token.allEvents({ fromBlock: web3.eth.defaultBlock }, (error, event) => { $("#loadingModal").modal("hide"); alert("Update successful.") })


  </script>


</body>